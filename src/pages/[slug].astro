---
import BlogHeader from "@/components/BlogHeader";
import BlogPost from "@/components/BlogPost";
import Footer from "@/components/Footer";
import BaseLayout from "@/layouts/base.astro";

export async function getStaticPaths() {
  const posts = await Astro.glob("/src/posts/*.md");
  const filteredPosts = posts.filter(
    ({ frontmatter }) =>
      process.env.NODE_ENV === "development" || !frontmatter.draft,
  );

  return filteredPosts.map((post) => ({
    params: { slug: post.frontmatter.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { frontmatter, default: PostContent } = post;
const { title, excerpt, thumbnail } = frontmatter;
---

<BaseLayout title={title} description={excerpt} image={thumbnail} isPost>
  <BlogHeader />

  <BlogPost {...frontmatter}>
    <PostContent />
  </BlogPost>

  <Footer />
</BaseLayout>
