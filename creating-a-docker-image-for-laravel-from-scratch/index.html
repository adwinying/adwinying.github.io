<!DOCTYPE html>
<html lang="en">
<head>
  <title>Creating a Docker image for Laravel from scratch - iAdwin</title>

<link rel="canonical" href="https://iadw.in/creating-a-docker-image-for-laravel-from-scratch/">

<meta name="description" content="How to make a docker image from scratch for Laravel.">

<meta name="robots" content="index, follow">

<meta property="og:title" content="Creating a Docker image for Laravel from scratch">
<meta property="og:type" content="article">
<meta property="og:image" content="https://iadw.in/">
<meta property="og:url" content="https://iadw.in/creating-a-docker-image-for-laravel-from-scratch/">


<meta property="og:description" content="How to make a docker image from scratch for Laravel.">






<meta property="og:image:url" content="https://iadw.in/">



<meta property="og:image:height">
<meta property="og:image:alt" content="Creating a Docker image for Laravel from scratch">


<meta name="twitter:card" content="summary_large_image">




<meta content="width=device-width, initial-scale=1.0" name="viewport"><meta content="Adwin Ying" name="author">


  <meta charSet="UTF-8"/><meta name="theme-color" content="#ffffff"/><link rel="icon" href="/favicon.svg"/><link rel="mask-icon" href="/mask-icon.svg" color="#000000"/><link rel="apple-touch-icon" href="/apple-touch-icon.png"/><link rel="manifest" href="/manifest.json"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,500;1,500&amp;family=Open+Sans:ital,wght@0,300;0,400;0,700;1,400;1,700&amp;display=swap"/>

  
<link rel="stylesheet" href="/assets/asset.09bf772d.css"></link>
</head>

<body class="flex flex-col bg-gray-50 min-h-screen ">
  <header class="container mx-auto flex items-center space-x-3 px-5 py-7"><a href="/" class="font-title text-3xl tracking-wider" aria-label="iAdwin">iA</a><span class="h-9 border-r-[2.5px] border-black"></span><a href="/blog" class="font-sans text-3xl font-normal text-gray-900">Blog</a><a href="/blog/rss.xml" target="_parent"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="mt-1 h-5"><path fill="currentColor" d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"></path></svg></a></header><article class="mx-auto w-full max-w-blog p-5 pb-9"><div class="mb-8 font-sans"><h1 class="mb-1 text-5xl font-bold text-gray-900">Creating a Docker image for Laravel from scratch</h1><span class="inline-block text-sm text-gray-600">04 Mar 2018 | <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="mr-1 inline-block h-2.5"><path fill="currentColor" d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"></path></svg><a href="/tag/docker" class="text-sm text-gray-600 underline-offset-1 hover:underline ">docker</a>, <a href="/tag/laravel" class="text-sm text-gray-600 underline-offset-1 hover:underline ">laravel</a>, <a href="/tag/php" class="text-sm text-gray-600 underline-offset-1 hover:underline ">php</a>, <a href="/tag/nodejs" class="text-sm text-gray-600 underline-offset-1 hover:underline ">nodejs</a></span></div><div class="prose prose-lg max-w-none font-serif
          prose-headings:font-sans
          prose-figcaption:-mt-6 prose-figcaption:text-center
          prose-figcaption:font-sans prose-figcaption:text-sm
          prose-img:mx-auto"><h2 id="background">Background</h2>
<p>I was looking at various stacks to develop a RESTful API and I came across Laravel. Laravel was a viable candidate mainly because it was in PHP (which my company is familiar with) and also it seems not too hard to develop (after going through a few webcasts on YouTube). Hence I decided take Laravel for a spin.</p>
<p>Never did I know setting up the development environment was a PITA.</p>
<h2 id="problem">Problem</h2>
<p>There were several options to set up Laravel locally, but none seem to work for me. Starting from the options from the official docs, <a href="https://laravel.com/docs/5.6/homestead">Laravel Homestead</a> was the recommended option but I wanted support for using Bash on Windows, which Vagrant doesnt support. Setting up from scratch isn't great either cause doing that on Windows is suicidal.</p>
<p>Next up, XAMPP wasn't a good choice as I have existing PHP projects where the PHP version isn't supported by Laravel. <a href="https://laravel.com/docs/5.5/valet">Valet</a> isn't a good option either as it is macOS only, which is a big no as I develop across different platforms.</p>
<p>So Docker was the most viable option, I guess. Docker supports Bash on Windows, albeit hacky (ie. Running commands from bash, but the daemon is running natively on Windows) as you need to install Docker on both bash and Windows. But that is a small price to pay in my opinion. Also, I've known Docker for awhile now and I've always wanted to try it out so why not?</p>
<h2 id="pre-built-docker-images">Pre-built Docker Images</h2>
<p>At first, things were looking good as there are already pre-built Docker Images for Laravel. One of the popular image is <a href="http://laradock.io/">Laradock</a>, with started out with Laravel but also expanded to other stacks as well.</p>
<p>However, after following the documentation, I couldn't see the laravel start page. Laradock bundles with MYSQL and phpmyadmin as well, and I couldn't access either of them.</p>
<p>Hence, I tried creating my own from scratch.</p>
<h2 id="file-structure">File structure</h2>
<p><strong>NOTE:</strong> Github repo available <a href="https://github.com/adwinying/docker-laravel">here</a></p>
<pre class="astro-code" style="background-color: #2e3440ff; overflow-x: auto;"><code><span class="line"><span style="color: #d8dee9ff">- docker-laravel</span></span>
<span class="line"><span style="color: #d8dee9ff"> |- docker-compose.yml</span></span>
<span class="line"><span style="color: #d8dee9ff"> |- web.dockerfile</span></span>
<span class="line"><span style="color: #d8dee9ff"> ...</span></span>
<span class="line"><span style="color: #d8dee9ff"> |- [other laravel source files go here]</span></span></code></pre>
<h2 id="step1-configuring-docker-compose">STEP1: Configuring docker-compose</h2>
<p>So the first thing I did was configuring a file called <code>docker-compose.yml</code>. In this file, the docker containers to be hosted and each of its configuration is listed out. In an empty directory I created the file, then entered the following:</p>
<pre class="astro-code" style="background-color: #2e3440ff; overflow-x: auto;"><code><span class="line"><span style="color: #616E88"># docker-compose.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color: #8FBCBB">version</span><span style="color: #ECEFF4">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&#39;</span><span style="color: #A3BE8C">2</span><span style="color: #ECEFF4">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #8FBCBB">services</span><span style="color: #ECEFF4">:</span><span style="color: #D8DEE9FF">                        </span><span style="color: #616E88"># list of services(containers)</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #8FBCBB">web</span><span style="color: #ECEFF4">:</span><span style="color: #D8DEE9FF">                           </span><span style="color: #616E88"># container name</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #8FBCBB">build</span><span style="color: #ECEFF4">:</span><span style="color: #D8DEE9FF">                       </span><span style="color: #616E88"># build options</span></span>
<span class="line"><span style="color: #D8DEE9FF">      </span><span style="color: #8FBCBB">context</span><span style="color: #ECEFF4">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">./</span><span style="color: #D8DEE9FF">                </span><span style="color: #616E88"># file path context</span></span>
<span class="line"><span style="color: #D8DEE9FF">      </span><span style="color: #8FBCBB">dockerfile</span><span style="color: #ECEFF4">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">web.dockerfile</span><span style="color: #D8DEE9FF"> </span><span style="color: #616E88"># path to dockerfile</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #8FBCBB">ports</span><span style="color: #ECEFF4">:</span><span style="color: #D8DEE9FF">                       </span><span style="color: #616E88"># ports to map</span></span>
<span class="line"><span style="color: #D8DEE9FF">      </span><span style="color: #ECEFF4">-</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">80:80</span><span style="color: #D8DEE9FF">                    </span><span style="color: #616E88"># [local port]:[container port]</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #8FBCBB">volumes</span><span style="color: #ECEFF4">:</span><span style="color: #D8DEE9FF">                     </span><span style="color: #616E88"># list of directories to map</span></span>
<span class="line"><span style="color: #D8DEE9FF">      </span><span style="color: #ECEFF4">-</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">./:/var/www</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #8FBCBB">links</span><span style="color: #ECEFF4">:</span><span style="color: #D8DEE9FF">                       </span><span style="color: #616E88"># links to other container</span></span>
<span class="line"><span style="color: #D8DEE9FF">      </span><span style="color: #ECEFF4">-</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">db</span><span style="color: #D8DEE9FF">                       </span><span style="color: #616E88"># db container; hosts the db container</span></span></code></pre>
<p>First off, the <code>web</code> container hosts the NGINX HTTP service, with Node.js and Laravel's <code>cli</code> installed and ready to use. This is done by loading up <code>web.dockerfile</code> which is created in the next step, then the relevant ports and volumes (directories) are linked between the local machine and docker container. Finally, <code>links</code> is used to link the web container with other containers, in this case the <code>db</code> container (created later) in order for laravel to communicate with the database.</p>
<h2 id="step2-configuring-the-dockerfile">STEP2: Configuring the dockerfile</h2>
<p>A <code>dockerfile</code> is a file that list outs the steps to build an image. A container is an instance of an image. In this case, I made a <code>dockerfile</code>named <code>web.dockerfile</code> for the <code>web</code> container:</p>
<pre class="astro-code" style="background-color: #2e3440ff; overflow-x: auto;"><code><span class="line"><span style="color: #616E88"># web.dockerfile</span></span>
<span class="line"></span>
<span class="line"><span style="color: #616E88"># Sourcing official docker image of PHP 7.1 with Apache web server</span></span>
<span class="line"><span style="color: #81A1C1">FROM</span><span style="color: #D8DEE9FF"> php:7.1-apache</span></span>
<span class="line"></span>
<span class="line"><span style="color: #616E88"># Change DocumentRoot directory</span></span>
<span class="line"><span style="color: #81A1C1">ENV</span><span style="color: #D8DEE9FF"> APACHE_DOCUMENT_ROOT /var/www/public</span></span>
<span class="line"><span style="color: #81A1C1">RUN</span><span style="color: #D8DEE9FF"> sed -ri -e </span><span style="color: #A3BE8C">&#39;s!/var/www/html!${APACHE_DOCUMENT_ROOT}!g&#39;</span><span style="color: #D8DEE9FF"> /etc/apache2/sites-available/*.conf &amp;&amp; \</span></span>
<span class="line"><span style="color: #D8DEE9FF">    sed -ri -e </span><span style="color: #A3BE8C">&#39;s!/var/www/!${APACHE_DOCUMENT_ROOT}!g&#39;</span><span style="color: #D8DEE9FF"> /etc/apache2/apache2.conf /etc/apache2/conf-available/*.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color: #616E88"># Install dependencies for nodejs &amp; laravel</span></span>
<span class="line"><span style="color: #81A1C1">RUN</span><span style="color: #D8DEE9FF"> apt-get update &amp;&amp; apt-get install -y gnupg zlib1g-dev</span></span>
<span class="line"><span style="color: #81A1C1">RUN</span><span style="color: #D8DEE9FF"> docker-php-ext-install zip</span></span>
<span class="line"></span>
<span class="line"><span style="color: #616E88"># Install nodejs</span></span>
<span class="line"><span style="color: #81A1C1">RUN</span><span style="color: #D8DEE9FF"> curl -sL https://deb.nodesource.com/setup_8.x | bash &amp;&amp; \</span></span>
<span class="line"><span style="color: #D8DEE9FF">	apt-get install -y nodejs</span></span>
<span class="line"></span>
<span class="line"><span style="color: #616E88"># Install composer</span></span>
<span class="line"><span style="color: #81A1C1">RUN</span><span style="color: #D8DEE9FF"> curl -sS https://getcomposer.org/installer | php &amp;&amp; \</span></span>
<span class="line"><span style="color: #D8DEE9FF">    mv composer.phar /usr/local/bin/composer &amp;&amp; \</span></span>
<span class="line"><span style="color: #D8DEE9FF">    chmod +x /usr/local/bin/composer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #616E88"># Install laravel globally</span></span>
<span class="line"><span style="color: #81A1C1">RUN</span><span style="color: #D8DEE9FF"> composer global require </span><span style="color: #A3BE8C">&quot;laravel/installer&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #616E88"># Add .composer/vendor/bin to bash_profile</span></span>
<span class="line"><span style="color: #81A1C1">RUN</span><span style="color: #D8DEE9FF"> echo export PATH=</span><span style="color: #A3BE8C">&#39;$HOME/.composer/vendor/bin:$PATH&#39;</span><span style="color: #D8DEE9FF"> &gt;&gt; ~/.bashrc &amp;&amp; \</span></span>
<span class="line"><span style="color: #D8DEE9FF">	echo cd .. &gt;&gt; ~/.bashrc</span></span></code></pre>
<p>At the time of this writing, PHP7.2 is available but it doesn't play well during the installation of Laravel, and hence PHP7.1 was used instead.</p>
<p>On top of the PHP7.1 image, Node.js and Laravel, together with their dependencies are automagically installed.</p>
<h2 id="step3-configuring-docker-compose-part-ii">STEP3: Configuring docker-compose, Part II</h2>
<p>Although now we have Laravel set up, we still need a database for it to store data. An instance of MYSQL is added by adding the following lines into <code>docker-compose.yml</code>:</p>
<pre class="astro-code" style="background-color: #2e3440ff; overflow-x: auto;"><code><span class="line"><span style="color: #616E88"># docker-compose.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color: #8FBCBB">version</span><span style="color: #ECEFF4">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&#39;</span><span style="color: #A3BE8C">2</span><span style="color: #ECEFF4">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #8FBCBB">services</span><span style="color: #ECEFF4">:</span><span style="color: #D8DEE9FF">                       </span><span style="color: #616E88"># list of services(containers)</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #8FBCBB">db</span><span style="color: #ECEFF4">:</span><span style="color: #D8DEE9FF">                           </span><span style="color: #616E88"># MYSQL instance is named db</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #8FBCBB">image</span><span style="color: #ECEFF4">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">mysql:5.7.21</span><span style="color: #D8DEE9FF">         </span><span style="color: #616E88"># Using MYSQL 5.7.21</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #8FBCBB">ports</span><span style="color: #ECEFF4">:</span><span style="color: #D8DEE9FF">                      </span><span style="color: #616E88"># Mapping ports from container to local machine</span></span>
<span class="line"><span style="color: #D8DEE9FF">      </span><span style="color: #ECEFF4">-</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">3306:3306</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #8FBCBB">environment</span><span style="color: #ECEFF4">:</span><span style="color: #D8DEE9FF">                </span><span style="color: #616E88"># Environment variables (change accordingly)</span></span>
<span class="line"><span style="color: #D8DEE9FF">      </span><span style="color: #8FBCBB">MYSQL_ROOT_PASSWORD</span><span style="color: #ECEFF4">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">root</span><span style="color: #D8DEE9FF"> </span><span style="color: #616E88"># Root password</span></span>
<span class="line"><span style="color: #D8DEE9FF">      </span><span style="color: #8FBCBB">MYSQL_DATABASE</span><span style="color: #ECEFF4">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">db</span><span style="color: #D8DEE9FF">        </span><span style="color: #616E88"># Database name</span></span>
<span class="line"><span style="color: #D8DEE9FF">      </span><span style="color: #8FBCBB">MYSQL_USER</span><span style="color: #ECEFF4">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">homestead</span><span style="color: #D8DEE9FF">     </span><span style="color: #616E88"># Username</span></span>
<span class="line"><span style="color: #D8DEE9FF">      </span><span style="color: #8FBCBB">MYSQL_PASSWORD</span><span style="color: #ECEFF4">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">secret</span><span style="color: #D8DEE9FF">    </span><span style="color: #616E88"># User password</span></span></code></pre>
<p>The MYSQL instance was spun up with the above credentials, which were injected to the container as environment variables. Then, the port 3306 of the container is then mapped to the local machine's port 3306.</p>
<h2 id="bonus-step-setting-up-phpmyadmin">BONUS STEP: Setting up phpMyAdmin</h2>
<p>At this point we can already start working on Laravel but, I wanted to set up phpMyAdmin to work on the MYSQL database in a easy-to-use GUI, as a bonus.</p>
<p>Again, going back to <code>docker-compose.yml</code>, another container <code>phpmyadmin</code> is set up by adding the following lines:</p>
<pre class="astro-code" style="background-color: #2e3440ff; overflow-x: auto;"><code><span class="line"><span style="color: #616E88"># docker-compose.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color: #8FBCBB">services</span><span style="color: #ECEFF4">:</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #8FBCBB">phpmyadmin</span><span style="color: #ECEFF4">:</span><span style="color: #D8DEE9FF">                        </span><span style="color: #616E88"># phpmyadmin container</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #8FBCBB">image</span><span style="color: #ECEFF4">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">phpmyadmin/phpmyadmin:4.7</span><span style="color: #D8DEE9FF"> </span><span style="color: #616E88"># Sourced from the official docker image of phpMyAdmin</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #8FBCBB">ports</span><span style="color: #ECEFF4">:</span><span style="color: #D8DEE9FF">                           </span><span style="color: #616E88"># Mapping ports</span></span>
<span class="line"><span style="color: #D8DEE9FF">      </span><span style="color: #ECEFF4">-</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">8080:80</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #8FBCBB">links</span><span style="color: #ECEFF4">:</span></span>
<span class="line"><span style="color: #D8DEE9FF">      </span><span style="color: #ECEFF4">-</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">db</span><span style="color: #D8DEE9FF">                           </span><span style="color: #616E88"># Linking phpmyadmin container with db container</span></span></code></pre>
<h2 id="step4-putting-it-all-together">STEP4: Putting it all together</h2>
<p>Finally, all the docker configuration has been set in place and it's time to spin up an instance. Run following commands in a terminal window:</p>
<pre class="astro-code" style="background-color: #2e3440ff; overflow-x: auto;"><code><span class="line"><span style="color: #616E88"># Build and start up a docker instance based on docker-compose.yml</span></span>
<span class="line"><span style="color: #616E88"># -d to run containers in detached mode</span></span>
<span class="line"><span style="color: #D8DEE9FF">$ docker-compose up -d</span></span>
<span class="line"></span>
<span class="line"><span style="color: #616E88"># Launch a bash shell into the web container</span></span>
<span class="line"><span style="color: #D8DEE9FF">$ docker-compose </span><span style="color: #88C0D0">exec</span><span style="color: #D8DEE9FF"> web bash</span></span>
<span class="line"></span>
<span class="line"><span style="color: #616E88"># Create a new laravel project</span></span>
<span class="line"><span style="color: #D8DEE9FF">$ laravel new</span></span></code></pre>
<p>If everything goes well, laravel should be up and running at <a href="http://localhost/">http://localhost/</a>. MYSQL and phpMyAdmin should be up and running at <a href="http://localhost:3306/">http://localhost:3306</a> and <a href="http://localhost:8080/">http://localhost:8080</a> respectively.</p>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="checking-status-of-containers">Checking status of containers</h3>
<p>In the project directory, run the following command:</p>
<pre class="astro-code" style="background-color: #2e3440ff; overflow-x: auto;"><code><span class="line"><span style="color: #D8DEE9FF">$ docker-compose ps</span></span></code></pre>
<h3 id="remapping-ports">Remapping Ports</h3>
<p>In <code>docker-compose.yml</code> the ports for each service can be changed. Eg: <code>mysql</code> service:</p>
<pre class="astro-code" style="background-color: #2e3440ff; overflow-x: auto;"><code><span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #8FBCBB">db</span><span style="color: #ECEFF4">:</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #8FBCBB">image</span><span style="color: #ECEFF4">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">mysql:5.7.21</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #8FBCBB">ports</span><span style="color: #ECEFF4">:</span></span>
<span class="line"><span style="color: #D8DEE9FF">      </span><span style="color: #ECEFF4">-</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">[</span><span style="color: #A3BE8C">your_local_machine_port_here</span><span style="color: #ECEFF4">]</span><span style="color: #A3BE8C">:3306</span></span></code></pre>
<h3 id="changing-the-directory-of-documentroot">Changing the directory of DocumentRoot</h3>
<p>In <code>web.dockerfile</code> change <code>ENV APACHE_DOCUMENT_ROOT /var/www/public</code> to the line below:</p>
<pre class="astro-code" style="background-color: #2e3440ff; overflow-x: auto;"><code><span class="line"><span style="color: #d8dee9ff">ENV APACHE_DOCUMENT_ROOT /path/to/new/DocumentRoot</span></span></code></pre>
<h3 id="rebuilding-the-containers-from-scratch">Rebuilding the containers from scratch</h3>
<p>In the project directory, run the following command:</p>
<pre class="astro-code" style="background-color: #2e3440ff; overflow-x: auto;"><code><span class="line"><span style="color: #616E88"># --build rebuilds the containers</span></span>
<span class="line"><span style="color: #D8DEE9FF">$ docker-compose up -d --build</span></span></code></pre>
<h3 id="permission-denied">Permission Denied</h3>
<blockquote>
<p>The stream or file "/var/www/storage/logs/laravel.log" could not be opened: failed to open stream: Permission denied</p>
</blockquote>
<p>If the above message is shown while trying to access <a href="http://localhost/">http://localhost/</a>, run the follow commands:</p>
<pre class="astro-code" style="background-color: #2e3440ff; overflow-x: auto;"><code><span class="line"><span style="color: #616E88"># Launch a bash shell into the web container</span></span>
<span class="line"><span style="color: #D8DEE9FF">$ docker-compose </span><span style="color: #88C0D0">exec</span><span style="color: #D8DEE9FF"> web bash</span></span>
<span class="line"><span style="color: #616E88"># Set permissions to 755 for /var/www</span></span>
<span class="line"><span style="color: #D8DEE9FF">$ chmod -R 755 </span><span style="color: #88C0D0">.</span></span>
<span class="line"><span style="color: #616E88"># Set owner of /var/www</span></span>
<span class="line"><span style="color: #D8DEE9FF">$ chown -R www-data:www-data </span><span style="color: #88C0D0">.</span></span></code></pre>
<h3 id="volume-mounts-not-working-with-bash-on-windows">Volume mounts not working with Bash on Windows</h3>
<p>Referring to <a href="https://github.com/Microsoft/WSL/issues/1854#issuecomment-291845122">this</a> Github issue, run the following commands in a terminal:</p>
<pre class="astro-code" style="background-color: #2e3440ff; overflow-x: auto;"><code><span class="line"><span style="color: #D8DEE9FF">$ sudo mkdir /c</span></span>
<span class="line"><span style="color: #D8DEE9FF">$ sudo mount --bind /mnt/c /c</span></span>
<span class="line"><span style="color: #D8DEE9FF">$ </span><span style="color: #88C0D0">cd</span><span style="color: #D8DEE9FF"> /c/path/to/project</span></span>
<span class="line"><span style="color: #D8DEE9FF">$ docker-compose up -d</span></span></code></pre>
<h2 id="future-work">Future Work</h2>
<ul>
<li>Multi-project support</li>
<li>SSL support</li>
</ul><hr/></div><div class="flex flex-col space-y-3 sm:flex-row sm:items-center sm:space-x-5 sm:space-y-0 mt-14 mb-9 font-sans text-base"><div class="w-28 sm:w-32"><img src="/img/avatar.png" srcSet="/img/avatar.png, /img/avatar-2x.png 2x" alt="Adwin Ying&#x27;s avatar"/></div><div class="flex flex-1 flex-col space-y-1"><span class="text-2xl font-bold">Adwin Ying</span><p class="text-gray-800">Self-taught full-stack web dev based in Tokyo. <br class="hidden sm:block"/>Occasionally wrecks servers through <a class="text-sky-500 hover:text-sky-700 " href="https://www.reddit.com/r/selfhosted/">self-hosting</a> and <a class="text-sky-500 hover:text-sky-700 " href="https://www.reddit.com/r/homelab/">homelab-ing</a>.</p><div class="flex"><a class="text-sky-500 hover:text-sky-700 flex space-x-1" href="/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="w-4"><path fill="currentColor" d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg><span>https://iAdw.in</span></a></div></div></div><a class="text-sky-500 hover:text-sky-700 font-sans !text-gray-900 underline underline-offset-2" href="/blog">← Back to all posts</a></article><footer class="bg-black py-3 text-center text-gray-50">iAdwin © 2022 Adwin Ying.</footer>
</body></html>
